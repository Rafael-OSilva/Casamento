<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Convidados - Casamento</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f9f7f7;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        header {
            background: linear-gradient(135deg, #d4af37 0%, #b08d57 100%);
            color: white;
            text-align: center;
            padding: 2rem 0;
            border-radius: 10px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            margin: 1rem 0;
        }
        .checkbox-group input {
            margin-right: 10px;
        }
        button {
            background: #d4af37;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background 0.3s;
        }
        button:hover {
            background: #b08d57;
        }
        .btn-danger {
            background: #e74c3c;
        }
        .btn-danger:hover {
            background: #c0392b;
        }
        .btn-success {
            background: #2ecc71;
        }
        .btn-success:hover {
            background: #27ae60;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #d4af37;
            margin-bottom: 0.5rem;
        }
        .stat-label {
            font-size: 1rem;
            color: #777;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
            font-weight: 600;
        }
        tr:hover {
            background-color: #f9f9f9;
        }
        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            flex-wrap: wrap;
            gap: 10px;
        }
        .export-options {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .no-data {
            text-align: center;
            padding: 2rem;
            color: #777;
        }
        .instructions {
            background-color: #f8f9fa;
            border-left: 4px solid #d4af37;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        .category-filter {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .category-filter button {
            background: #6c757d;
        }
        .category-filter button.active {
            background: #d4af37;
        }
        .category-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        .badge-noivo {
            background: #e3f2fd;
            color: #0d47a1;
        }
        .badge-noiva {
            background: #fce4ec;
            color: #880e4f;
        }
        .badge-padrinhos {
            background: #e8f5e9;
            color: #1b5e20;
        }
        .badge-amigos {
            background: #fff3e0;
            color: #e65100;
        }
        @media (max-width: 768px) {
            .stats {
                grid-template-columns: 1fr;
            }
            .actions {
                flex-direction: column;
            }
            .export-options {
                flex-direction: column;
            }
            .category-filter {
                flex-direction: column;
            }
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Lista de Convidados</h1>
            <p class="subtitle">Organize sua lista de convidados para o casamento</p>
        </header>

        <div class="instructions">
            <h3>Como usar:</h3>
            <p>1. Adicione os convidados usando o formulário abaixo</p>
            <p>2. Os dados são salvos automaticamente no seu navegador</p>
            <p>3. Use o botão "Exportar para CSV" para fazer backup dos dados</p>
            <p>4. Use o botão "Importar de CSV" para restaurar dados de um backup</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="total-pessoas">0</div>
                <div class="stat-label">Total de Pessoas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-adultos">0</div>
                <div class="stat-label">Adultos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-criancas">0</div>
                <div class="stat-label">Crianças</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-familias">0</div>
                <div class="stat-label">Famílias Convidadas</div>
            </div>
        </div>

        <div class="card">
            <h2>Adicionar Convidado</h2>
            <form id="form-convidado">
                <div class="form-group">
                    <label for="categoria">Convidado à parte de:</label>
                    <select id="categoria" name="categoria" required>
                        <option value="">Selecione uma categoria</option>
                        <option value="familia_noivo">Família do Noivo</option>
                        <option value="familia_noiva">Família da Noiva</option>
                        <option value="padrinhos">Padrinhos</option>
                        <option value="amigos">Amigos</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="nome">Nome do Convidado:</label>
                    <input type="text" id="nome" name="nome" required placeholder="Ex: Daniel Ribeiro Dias">
                </div>
                
                <div class="form-group">
                    <label for="acompanhante">Acompanhante Adulto:</label>
                    <input type="text" id="acompanhante" name="acompanhante" placeholder="Ex: Luana Ribeiro Souza (deixe em branco se não houver)">
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="tem_criancas" name="tem_criancas">
                    <label for="tem_criancas">Traz crianças?</label>
                </div>
                
                <div class="form-group" id="criancas-group" style="display: none;">
                    <label for="quantidade_criancas">Quantidade de Crianças:</label>
                    <input type="number" id="quantidade_criancas" name="quantidade_criancas" min="1" value="1">
                </div>
                
                <div class="actions">
                    <button type="submit">Adicionar à Lista</button>
                    <button type="button" id="btn-limpar" class="btn-danger">Limpar Lista</button>
                </div>
            </form>
        </div>

        <div class="card">
            <h2>Lista de Convidados</h2>
            
            <div class="category-filter">
                <button type="button" data-category="all" class="active">Todos</button>
                <button type="button" data-category="familia_noivo">Família Noivo</button>
                <button type="button" data-category="familia_noiva">Família Noiva</button>
                <button type="button" data-category="padrinhos">Padrinhos</button>
                <button type="button" data-category="amigos">Amigos</button>
            </div>
            
            <div id="lista-convidados" class="no-data">
                Nenhum convidado cadastrado ainda.
            </div>
            
            <div class="export-options">
                <button type="button" id="btn-exportar" class="btn-success">Exportar para CSV</button>
                <button type="button" id="btn-importar">Importar de CSV</button>
                <input type="file" id="import-file" accept=".csv" style="display: none;">
            </div>
        </div>
    </div>

    <script>
        // Elementos do DOM
        const formConvidado = document.getElementById('form-convidado');
        const btnLimpar = document.getElementById('btn-limpar');
        const btnExportar = document.getElementById('btn-exportar');
        const btnImportar = document.getElementById('btn-importar');
        const importFile = document.getElementById('import-file');
        const temCriancasCheckbox = document.getElementById('tem_criancas');
        const criancasGroup = document.getElementById('criancas-group');
        const categoryButtons = document.querySelectorAll('.category-filter button');
        
        // Categorias
        const categorias = {
            'familia_noivo': 'Família do Noivo',
            'familia_noiva': 'Família da Noiva',
            'padrinhos': 'Padrinhos',
            'amigos': 'Amigos'
        };
        
        // Classes para badges
        const badgeClasses = {
            'familia_noivo': 'badge-noivo',
            'familia_noiva': 'badge-noiva',
            'padrinhos': 'badge-padrinhos',
            'amigos': 'badge-amigos'
        };
        
        // Filtro atual
        let currentFilter = 'all';
        
        // Inicializar dados
        let convidados = JSON.parse(localStorage.getItem('convidados')) || [];
        
        // Atualizar estatísticas e lista
        function atualizarDados() {
            atualizarEstatisticas();
            renderizarLista();
        }
        
        // Atualizar estatísticas
        function atualizarEstatisticas() {
            let totalAdultos = 0;
            let totalCriancas = 0;
            
            convidados.forEach(convidado => {
                totalAdultos += 1; // O convidado principal
                if (convidado.acompanhante) totalAdultos += 1; // Acompanhante
                if (convidado.criancas) totalCriancas += parseInt(convidado.criancas);
            });
            
            document.getElementById('total-pessoas').textContent = totalAdultos + totalCriancas;
            document.getElementById('total-adultos').textContent = totalAdultos;
            document.getElementById('total-criancas').textContent = totalCriancas;
            document.getElementById('total-familias').textContent = convidados.length;
        }
        
        // Renderizar lista de convidados
        function renderizarLista() {
            const listaElement = document.getElementById('lista-convidados');
            
            // Filtrar convidados
            const convidadosFiltrados = currentFilter === 'all' 
                ? convidados 
                : convidados.filter(c => c.categoria === currentFilter);
            
            if (convidadosFiltrados.length === 0) {
                const message = currentFilter === 'all' 
                    ? 'Nenhum convidado cadastrado ainda.' 
                    : `Nenhum convidado na categoria "${categorias[currentFilter]}".`;
                listaElement.innerHTML = `<div class="no-data">${message}</div>`;
                return;
            }
            
            let html = `
                <table>
                    <tr>
                        <th>Categoria</th>
                        <th>Convidado</th>
                        <th>Acompanhante</th>
                        <th>Crianças</th>
                        <th>Ações</th>
                    </tr>
            `;
            
            convidadosFiltrados.forEach((convidado, index) => {
                // Encontrar índice real no array completo
                const realIndex = convidados.findIndex(c => 
                    c.nome === convidado.nome && 
                    c.categoria === convidado.categoria
                );
                
                html += `
                    <tr>
                        <td><span class="category-badge ${badgeClasses[convidado.categoria]}">${categorias[convidado.categoria]}</span></td>
                        <td>${convidado.nome}</td>
                        <td>${convidado.acompanhante || '-'}</td>
                        <td>${convidado.criancas || '-'}</td>
                        <td>
                            <button type="button" class="btn-danger btn-remover" data-index="${realIndex}">Remover</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</table>';
            listaElement.innerHTML = html;
            
            // Adicionar event listeners aos botões de remover
            document.querySelectorAll('.btn-remover').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    removerConvidado(index);
                });
            });
        }
        
        // Adicionar convidado
        function adicionarConvidado(categoria, nome, acompanhante, criancas) {
            convidados.push({
                categoria,
                nome,
                acompanhante: acompanhante || null,
                criancas: criancas || null
            });
            
            localStorage.setItem('convidados', JSON.stringify(convidados));
            atualizarDados();
        }
        
        // Remover convidado
        function removerConvidado(index) {
            if (confirm('Tem certeza que deseja remover este convidado?')) {
                convidados.splice(index, 1);
                localStorage.setItem('convidados', JSON.stringify(convidados));
                atualizarDados();
            }
        }
        
        // Limpar lista
        function limparLista() {
            if (confirm('Tem certeza que deseja limpar toda a lista? Esta ação não pode ser desfeita.')) {
                convidados = [];
                localStorage.removeItem('convidados');
                atualizarDados();
            }
        }
        
        // Exportar para CSV
        function exportarParaCSV() {
            if (convidados.length === 0) {
                alert('Não há dados para exportar.');
                return;
            }
            
            let csv = 'Categoria,Convidado,Acompanhante,Crianças\n';
            
            convidados.forEach(convidado => {
                csv += `"${categorias[convidado.categoria]}","${convidado.nome}","${convidado.acompanhante || ''}","${convidado.criancas || ''}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'lista_convidados_casamento.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Importar de CSV
        function importarDeCSV(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const content = e.target.result;
                const lines = content.split('\n');
                const novosConvidados = [];
                
                // Pular o cabeçalho e processar cada linha
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    // Processar CSV considerando aspas
                    const values = [];
                    let current = '';
                    let insideQuotes = false;
                    
                    for (let char of line) {
                        if (char === '"') {
                            insideQuotes = !insideQuotes;
                        } else if (char === ',' && !insideQuotes) {
                            values.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    values.push(current.trim());
                    
                    if (values.length >= 2 && values[1]) {
                        // Encontrar a chave da categoria pelo valor
                        let categoriaKey = '';
                        for (const [key, value] of Object.entries(categorias)) {
                            if (value === values[0].replace(/^"|"$/g, '')) {
                                categoriaKey = key;
                                break;
                            }
                        }
                        
                        if (!categoriaKey) {
                            // Se não encontrou, usar a primeira categoria como padrão
                            categoriaKey = 'familia_noivo';
                        }
                        
                        novosConvidados.push({
                            categoria: categoriaKey,
                            nome: values[1].replace(/^"|"$/g, ''),
                            acompanhante: values[2] ? values[2].replace(/^"|"$/g, '') : null,
                            criancas: values[3] ? values[3].replace(/^"|"$/g, '') : null
                        });
                    }
                }
                
                if (novosConvidados.length > 0) {
                    if (confirm(`Encontrados ${novosConvidados.length} convidados no arquivo. Deseja importar?`)) {
                        convidados = convidados.concat(novosConvidados);
                        localStorage.setItem('convidados', JSON.stringify(convidados));
                        atualizarDados();
                        alert('Dados importados com sucesso!');
                    }
                } else {
                    alert('Nenhum convidado válido encontrado no arquivo.');
                }
            };
            
            reader.readAsText(file);
        }
        
        // Event Listeners
        formConvidado.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const categoria = document.getElementById('categoria').value;
            const nome = document.getElementById('nome').value.trim();
            const acompanhante = document.getElementById('acompanhante').value.trim();
            const temCriancas = document.getElementById('tem_criancas').checked;
            const quantidadeCriancas = temCriancas ? parseInt(document.getElementById('quantidade_criancas').value) : null;
            
            if (!categoria) {
                alert('Por favor, selecione uma categoria.');
                return;
            }
            
            if (!nome) {
                alert('Por favor, informe o nome do convidado.');
                return;
            }
            
            if (quantidadeCriancas !== null && (isNaN(quantidadeCriancas) || quantidadeCriancas < 1)) {
                alert('Por favor, informe uma quantidade válida de crianças.');
                return;
            }
            
            adicionarConvidado(categoria, nome, acompanhante || null, quantidadeCriancas);
            
            // Limpar formulário, mantendo a categoria
            document.getElementById('nome').value = '';
            document.getElementById('acompanhante').value = '';
            document.getElementById('tem_criancas').checked = false;
            criancasGroup.style.display = 'none';
            document.getElementById('quantidade_criancas').value = '1';
        });
        
        temCriancasCheckbox.addEventListener('change', function() {
            criancasGroup.style.display = this.checked ? 'block' : 'none';
        });
        
        btnLimpar.addEventListener('click', limparLista);
        
        btnExportar.addEventListener('click', exportarParaCSV);
        
        btnImportar.addEventListener('click', function() {
            importFile.click();
        });
        
        importFile.addEventListener('change', function() {
            if (this.files.length > 0) {
                importarDeCSV(this.files[0]);
                this.value = ''; // Resetar o input
            }
        });
        
        // Filtros de categoria
        categoryButtons.forEach(button => {
            button.addEventListener('click', function() {
                const category = this.getAttribute('data-category');
                
                // Atualizar botões ativos
                categoryButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Aplicar filtro
                currentFilter = category;
                renderizarLista();
            });
        });
        
        // Inicializar
        atualizarDados();
    </script>
</body>
</html>